<section id="github" class="py-24 bg-secondary-color">
  <div class="container mx-auto px-6">
    <!-- Section Header -->
    <div class="text-center mb-16" appScrollAnimation animationClass="animate-fade-in-up">
      <h2 class="text-4xl font-bold mb-4">GitHub <span class="text-accent-color">Projects</span></h2>
      <div class="w-20 h-1 bg-accent-color mx-auto"></div>
      <p class="text-text-secondary mt-4 max-w-2xl mx-auto">
        Explore my latest open-source projects directly from GitHub
      </p>
    </div>
    
    <!-- Loading State -->
    <div *ngIf="loading" class="text-center py-12">
      <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-accent-color"></div>
      <p class="text-text-secondary mt-4">Loading projects from GitHub...</p>
    </div>
    
    <!-- Error State -->
    <div *ngIf="error" class="text-center py-12 text-red-400">
      <p>{{ error }}</p>
    </div>
    
    <!-- Repository Grid -->
    <div *ngIf="!loading && !error" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <div 
        *ngFor="let repo of repos; let i = index" 
        class="bg-primary-color rounded-lg overflow-hidden shadow-lg transition-all duration-300 hover:shadow-accent-color/20 transform hover:-translate-y-1"
        appScrollAnimation
        [animationClass]="'animate-fade-in-up'">
        
        <!-- Repository Header -->
        <div class="p-6 border-b border-accent-color/10">
          <div class="flex justify-between items-center mb-3">
            <h3 class="text-xl font-semibold text-white truncate">{{ repo.name }}</h3>
            <div class="flex items-center space-x-2">
              <a *ngIf="repo.homepage" 
                 [href]="repo.homepage" 
                 target="_blank" 
                 rel="noopener noreferrer" 
                 class="text-accent-color hover:text-accent-color/80 transition-colors"
                 title="Visit website">
                <fa-icon [icon]="faGlobe"></fa-icon>
              </a>
              <a [href]="repo.html_url" 
                 target="_blank" 
                 rel="noopener noreferrer" 
                 class="text-accent-color hover:text-accent-color/80 transition-colors"
                 title="View on GitHub">
                <fa-icon [icon]="faGithub"></fa-icon>
              </a>
            </div>
          </div>
          
          <!-- Language Badge -->
          <div *ngIf="repo.language" class="inline-block px-3 py-1 rounded-full bg-accent-color/10 text-accent-color text-sm font-medium">
            {{ repo.language }}
          </div>
        </div>
        
        <!-- Repository Description -->
        <div class="p-6">
          <!-- Expandable Description Container -->
          <div class="description-container relative mb-4">
            <div 
              [class.description-short]="!expandedDescriptions[repo.id]" 
              [class.description-expanded]="expandedDescriptions[repo.id]"
              class="text-text-secondary description-text overflow-hidden transition-all duration-300" 
              [appLinkHoverWebview]="repo.description || ''"
              [class.cursor-pointer]="hasLinksInDescription(repo.description || '')">
              {{ repo.description || 'No description available' }}
            </div>
            
            <button 
              *ngIf="isDescriptionLong(repo.description)" 
              (click)="toggleDescription(repo.id)"
              class="text-accent-color text-xs mt-1 hover:underline focus:outline-none">
              {{ expandedDescriptions[repo.id] ? 'Show less' : 'Show more' }}
            </button>
          </div>
          
          <!-- Repository Stats -->
          <div class="flex justify-between text-text-secondary text-sm">
            <div class="flex items-center space-x-4">
              <span class="flex items-center">
                <fa-icon [icon]="faStar" class="mr-1"></fa-icon>
                {{ repo.stargazers_count }}
              </span>
              
              <span class="flex items-center">
                <fa-icon [icon]="faCodeBranch" class="mr-1"></fa-icon>
                {{ repo.forks_count }}
              </span>
            </div>
            
            <span class="flex items-center">
              <fa-icon [icon]="faCalendarAlt" class="mr-1"></fa-icon>
              {{ repo.pushed_at | date:'MMM yyyy' }}
            </span>
          </div>
          
          <!-- Action Buttons -->
          <div class="mt-6 flex space-x-3">
            <a 
              [href]="repo.html_url" 
              target="_blank" 
              rel="noopener noreferrer" 
              class="flex-1 px-4 py-2 bg-secondary-color text-text-color border border-accent-color/20 rounded-md text-center hover:bg-accent-color/10 transition-colors duration-300 flex items-center justify-center space-x-1">
              <fa-icon [icon]="faCode" class="text-sm"></fa-icon>
              <span>Code</span>
            </a>
            
            <a 
              *ngIf="repo.homepage" 
              [href]="repo.homepage" 
              target="_blank" 
              rel="noopener noreferrer" 
              class="flex-1 px-4 py-2 bg-secondary-color text-text-color border border-accent-color/20 rounded-md text-center hover:bg-accent-color/10 transition-colors duration-300 flex items-center justify-center space-x-1">
              <fa-icon [icon]="faGlobe" class="text-sm"></fa-icon>
              <span>Website</span>
            </a>
            
            <button 
              *ngIf="hasPreviewUrl(repo)" 
              (click)="openPreview(repo)" 
              class="flex-1 px-4 py-2 bg-accent-color text-white rounded-md text-center hover:bg-accent-color/90 transition-colors duration-300 flex items-center justify-center space-x-1">
              <fa-icon [icon]="faExternalLinkAlt" class="text-sm"></fa-icon>
              <span>Preview</span>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- View More Buttons -->
    <div class="text-center mt-12 space-x-4">
      <button 
        (click)="loadMoreRepos()" 
        class="inline-block px-6 py-3 bg-accent-color text-white border border-accent-color rounded-md hover:bg-accent-color/90 transition-all duration-300 hover:-translate-y-1"
        [disabled]="isLoadingMore || allReposLoaded">
        <span class="flex items-center space-x-2">
          <span>{{ isLoadingMore ? 'Loading...' : allReposLoaded ? 'All Loaded' : 'Load More' }}</span>
          <fa-icon *ngIf="!isLoadingMore && !allReposLoaded" [icon]="faAngleDown"></fa-icon>
          <span *ngIf="isLoadingMore" class="inline-block w-4 h-4 border-2 border-t-transparent border-white rounded-full animate-spin"></span>
          <fa-icon *ngIf="allReposLoaded && !isLoadingMore" [icon]="faCheck"></fa-icon>
        </span>
      </button>
      
      <a 
        href="https://github.com/ayoubachak?tab=repositories"
        target="_blank" 
        rel="noopener noreferrer" 
        class="inline-block px-6 py-3 bg-primary-color text-text-color border border-accent-color/20 rounded-md hover:bg-accent-color/10 transition-all duration-300 hover:-translate-y-1">
        <span class="flex items-center space-x-2">
          <span>View on GitHub</span>
          <fa-icon [icon]="faGithub"></fa-icon>
        </span>
      </a>
    </div>
  </div>
  
  <!-- Project Preview Modal (Hidden by default) -->
  <div 
    *ngIf="showIframe" 
    class="fixed inset-0 z-50 overflow-hidden flex items-center justify-center p-2 sm:p-4 md:p-8"
    #previewModal>
    
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/80" (click)="closePreview()"></div>
    
    <!-- Modal Content -->
    <div class="relative bg-primary-color rounded-lg shadow-xl w-full max-w-6xl h-[90vh] sm:h-[85vh] flex flex-col overflow-hidden">
      <!-- Modal Header -->
      <div class="p-3 md:p-4 border-b border-accent-color/10 flex justify-between items-center">
        <h3 class="text-lg md:text-xl font-semibold text-white truncate pr-2">{{ activeRepo?.name }} Preview</h3>
        <div class="flex space-x-2 items-center">
          <button 
            (click)="toggleMobileView()" 
            class="text-text-secondary hover:text-accent-color transition-colors p-1 hidden sm:block"
            title="Toggle Mobile View">
            <fa-icon [icon]="isMobileView ? faDesktop : faMobile"></fa-icon>
          </button>
          <a 
            [href]="activeRepo?.demoUrl || activeRepo?.homepage" 
            target="_blank" 
            rel="noopener noreferrer" 
            class="text-text-secondary hover:text-accent-color transition-colors p-1"
            title="Open in New Tab">
            <fa-icon [icon]="faExternalLinkAlt"></fa-icon>
          </a>
          <button (click)="closePreview()" class="text-text-secondary hover:text-accent-color transition-colors">
            <fa-icon [icon]="faTimesCircle" size="lg"></fa-icon>
          </button>
        </div>
      </div>
      
      <!-- IFrame Container -->
      <div class="p-2 md:p-4 flex-1 relative"
           style="height: calc(90vh - 130px);">
        <!-- Loading indicator -->
        <div *ngIf="iframeLoading && safePreviewUrl" class="absolute inset-0 flex items-center justify-center bg-primary-color/80 z-10">
          <div class="flex flex-col items-center">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-accent-color"></div>
            <p class="text-text-secondary mt-4">Loading preview...</p>
          </div>
        </div>
        
        <!-- Mobile Container (shown when mobile view is enabled) -->
        <div *ngIf="isMobileView && safePreviewUrl" class="mobile-device-frame mx-auto h-full flex flex-col items-center justify-center">
          <div class="mobile-frame relative rounded-[40px] bg-gray-900 border-8 border-gray-900 shadow-lg p-1 overflow-hidden h-[95%] max-h-[740px] w-[360px] max-w-full">
            <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-32 h-6 bg-gray-900 rounded-b-xl z-10"></div>
            <iframe 
              [src]="safePreviewUrl" 
              class="w-full h-full border-0 rounded-lg"
              loading="lazy"
              sandbox="allow-scripts allow-same-origin allow-forms"
              referrerpolicy="no-referrer"
              title="Mobile Preview"
              (load)="onIframeLoad()">
            </iframe>
          </div>
        </div>
        
        <!-- Regular iframe (shown when mobile view is disabled) -->
        <iframe 
          *ngIf="safePreviewUrl && !isMobileView" 
          [src]="safePreviewUrl" 
          class="w-full h-full border-0 rounded-md"
          loading="lazy"
          sandbox="allow-scripts allow-same-origin allow-forms"
          referrerpolicy="no-referrer"
          title="Project Preview"
          (load)="onIframeLoad()">
        </iframe>
        
        <div *ngIf="!safePreviewUrl" class="w-full h-full flex items-center justify-center text-text-secondary">
          <p>No preview available for this project.</p>
        </div>
      </div>
      
      <!-- Modal Footer -->
      <div class="p-3 md:p-4 border-t border-accent-color/10 flex justify-between items-center">
        <a 
          [href]="activeRepo?.html_url" 
          target="_blank" 
          rel="noopener noreferrer" 
          class="px-3 py-2 bg-secondary-color text-text-color border border-accent-color/20 rounded-md hover:bg-accent-color/10 transition-colors text-sm md:text-base">
          View on GitHub
        </a>
        
        <button 
          (click)="closePreview()" 
          class="px-3 py-2 bg-accent-color text-white rounded-md hover:bg-accent-color/90 transition-colors text-sm md:text-base">
          Close Preview
        </button>
      </div>
    </div>
  </div>

  <!-- Add the webview preview component at the end of the section -->
  <app-webview-preview></app-webview-preview>
</section> 